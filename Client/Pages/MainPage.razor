@page "/"
@using Microsoft.AspNetCore.SignalR.Client
@inject NavigationManager NavigationManager
@if(roomId is null){
    <CreateAccount Connection="@hubConnection"/>
    <AvailableGames Connection="@hubConnection" ConnectionId="@connectionId"/>
} else {
    <BoardGame Connection="@hubConnection" Room="@RoomId" User="@connectionId"/>
}

@code {
    private HubConnection? hubConnection;
    private string connectionId;
    private string? roomId;
    private string? RoomId {
        get => roomId;
        set {
            roomId = value;
            StateHasChanged();
        }
    }

    protected override async Task OnInitializedAsync()
    {
        hubConnection = new HubConnectionBuilder()
            .WithUrl(NavigationManager.ToAbsoluteUri("/gamehub"))
            .Build();


        hubConnection.On<string>("GetGameStarted", (room) =>
        {
            RoomId = room;
            StateHasChanged();
        });

        hubConnection.On<string>("GetGameEnded", (room) =>
        {
            if(room == RoomId){
                RoomId = null;
            }
            StateHasChanged();
        });

        await hubConnection.StartAsync();
        connectionId = await hubConnection.InvokeAsync<string>("GetId");
    }
}